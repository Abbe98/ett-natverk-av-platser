<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Byggnadstidslinjer per kommun</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #ffffff;
            color: #333;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 40px;
            color: #1a1a1a;
            letter-spacing: -0.5px;
        }

        .timeline-container {
            display: flex;
            flex-direction: column;
            gap: 1px;
            background: #f5f5f5;
            padding: 1px;
        }

        .municipality-row {
            display: flex;
            align-items: center;
            background: #ffffff;
            min-height: 50px;
            padding: 12px 0;
        }

        .municipality-name {
            width: 180px;
            flex-shrink: 0;
            padding: 0 20px;
            font-size: 13px;
            color: #4a4a4a;
            font-weight: 400;
        }

        .timeline {
            flex: 1;
            position: relative;
            height: 30px;
            border-left: 1px solid #e0e0e0;
            padding-left: 20px;
        }

        .timeline-axis {
            position: absolute;
            top: 50%;
            left: 20px;
            right: 0;
            height: 1px;
            background: #e8e8e8;
        }

        .building-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #666;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.6;
            cursor: pointer;
        }

        .building-dot:hover {
            opacity: 1;
            width: 6px;
            height: 6px;
            background: #333;
        }

        .year-markers {
            position: relative;
            margin-bottom: 20px;
            margin-left: 201px;
            height: 30px;
        }

        .year-marker {
            position: absolute;
            font-size: 11px;
            color: #999;
            transform: translateX(-50%);
        }

        .year-marker::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            height: 8px;
            background: #e0e0e0;
        }

        .tooltip {
            position: fixed;
            background: #2a2a2a;
            color: #fff;
            padding: 6px 10px;
            border-radius: 3px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
            white-space: nowrap;
        }

        .tooltip.visible {
            opacity: 0.95;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        .stats {
            margin-bottom: 30px;
            font-size: 12px;
            color: #777;
            letter-spacing: 0.3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Byggnadstidslinjer per kommun</h1>
        <div class="stats" id="stats"></div>
        <div class="loading" id="loading">Laddar data...</div>
        <div class="year-markers" id="yearMarkers"></div>
        <div class="timeline-container" id="timelineContainer"></div>
    </div>
    <div class="tooltip" id="tooltip"></div>

    <script>
        const tooltip = document.getElementById('tooltip');
        const loading = document.getElementById('loading');
        const timelineContainer = document.getElementById('timelineContainer');
        const yearMarkers = document.getElementById('yearMarkers');
        const stats = document.getElementById('stats');

        // Parse CSV
        async function loadData() {
            try {
                const response = await fetch('Byggnader med startdatum, kommuner.csv');
                const csvText = await response.text();

                const lines = csvText.trim().split('\n');
                const headers = parseCSVLine(lines[0]);

                const data = [];
                for (let i = 1; i < lines.length; i++) {
                    const values = parseCSVLine(lines[i]);
                    if (values.length === headers.length) {
                        const year = parseInt(values[2]);
                        if (!isNaN(year)) {
                            data.push({
                                id: values[0],
                                name: values[1],
                                year: year,
                                municipality: values[3]
                            });
                        }
                    }
                }

                return data;
            } catch (error) {
                console.error('Error loading data:', error);
                loading.textContent = 'Fel vid laddning av data';
                return [];
            }
        }

        function parseCSVLine(line) {
            const values = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];

                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim());

            return values;
        }

        // Group data by municipality
        function groupByMunicipality(data) {
            const groups = {};

            data.forEach(building => {
                if (!groups[building.municipality]) {
                    groups[building.municipality] = [];
                }
                groups[building.municipality].push(building);
            });

            // Sort municipalities by number of buildings (descending)
            return Object.keys(groups)
                .sort((a, b) => groups[b].length - groups[a].length)
                .map(municipality => ({
                    municipality,
                    buildings: groups[municipality]
                }));
        }

        // Create visualization
        function createVisualization(data) {
            const grouped = groupByMunicipality(data);

            // Find min and max years
            const years = data.map(b => b.year);
            const minYear = Math.min(...years);
            const maxYear = Math.max(...years);
            const yearRange = maxYear - minYear;

            // Update stats
            stats.textContent = `${data.length} byggnader i ${grouped.length} kommuner (${minYear}â€“${maxYear})`;

            // Clear loading
            loading.style.display = 'none';

            // Create municipality rows
            grouped.forEach(group => {
                const row = document.createElement('div');
                row.className = 'municipality-row';

                const name = document.createElement('div');
                name.className = 'municipality-name';
                name.textContent = group.municipality;

                const timeline = document.createElement('div');
                timeline.className = 'timeline';

                const axis = document.createElement('div');
                axis.className = 'timeline-axis';
                timeline.appendChild(axis);

                // Add buildings as dots
                group.buildings.forEach(building => {
                    const dot = document.createElement('div');
                    dot.className = 'building-dot';

                    const position = ((building.year - minYear) / yearRange) * 100;
                    dot.style.left = `${position}%`;

                    // Tooltip on hover
                    dot.addEventListener('mouseenter', (e) => {
                        tooltip.textContent = `${building.name} (${building.year})`;
                        tooltip.classList.add('visible');
                    });

                    dot.addEventListener('mousemove', (e) => {
                        tooltip.style.left = `${e.clientX + 10}px`;
                        tooltip.style.top = `${e.clientY + 10}px`;
                    });

                    dot.addEventListener('mouseleave', () => {
                        tooltip.classList.remove('visible');
                    });

                    // Click to open building URL in new tab
                    dot.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.open(building.id, '_blank');
                    });

                    timeline.appendChild(dot);
                });

                row.appendChild(name);
                row.appendChild(timeline);
                timelineContainer.appendChild(row);
            });

            // Create year markers
            const markerYears = generateYearMarkers(minYear, maxYear);
            markerYears.forEach(year => {
                const marker = document.createElement('div');
                marker.className = 'year-marker';
                marker.textContent = year;

                // Position based on year percentage
                const position = ((year - minYear) / yearRange) * 100;
                marker.style.left = `${position}%`;

                yearMarkers.appendChild(marker);
            });
        }

        function generateYearMarkers(minYear, maxYear) {
            const range = maxYear - minYear;
            let step;

            if (range > 500) step = 100;
            else if (range > 200) step = 50;
            else if (range > 100) step = 25;
            else step = 10;

            const markers = [];
            const start = Math.ceil(minYear / step) * step;

            for (let year = start; year <= maxYear; year += step) {
                markers.push(year);
            }

            return markers;
        }

        // Initialize
        loadData().then(data => {
            if (data.length > 0) {
                createVisualization(data);
            }
        });
    </script>
</body>
</html>
